#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

origin_file=.last-origin 

branch_name="$(git symbolic-ref HEAD 2>/dev/null)"
branch_name=${branch_name##refs/heads/}

repo_url=$(node -pe "require('./package.json').repository.url") 
current_origin_sha=$(git ls-remote "${repo_url}" | grep "refs/heads/develop" | awk '{ print $1 }' )
saved_origin=`cat $origin_file`

echo ORIGIN $current_origin_sha
echo SAVED_ORIGIN $saved_origin

if [[ $current_origin_sha == "$saved_origin"  ]]; then
    echo "> Same origin."
    exit 0
fi

echo "$current_origin_sha" > .last-origin

git add .last-origin
git commit -m "fix(last-origin): updated" --no-verify
git reset HEAD~1 --soft
git commit --amend --no-edit
